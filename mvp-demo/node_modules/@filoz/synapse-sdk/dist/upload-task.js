import { CID } from 'multiformats/cid';
export class MockUploadTask {
    _data;
    _commp;
    _sp;
    _txHash;
    _withCDN;
    constructor(data, withCDN) {
        this._data = data instanceof ArrayBuffer ? new Uint8Array(data) : data;
        this._withCDN = withCDN;
        console.log('[MockSynapse] UploadTask created with', this._data.length, 'bytes (withCDN=', this._withCDN, ')');
    }
    async commp() {
        console.log('[MockSynapse] UploadTask.commp() called');
        if (this._commp == null) {
            console.log('[MockSynapse] Generating mock CommP for', this._data.length, 'bytes...');
            console.log('[MockSynapse] Simulating CommP calculation delay...');
            await new Promise(resolve => setTimeout(resolve, 100));
            const mockCommPString = 'baga6ea4seaqjtovkwk4myyzj56eztkh5pzsk5upksan6f5outesy62bsvl4dsha';
            this._commp = CID.parse(mockCommPString);
            console.log('[MockSynapse] CommP generated:', this._commp.toString());
        }
        else {
            console.log('[MockSynapse] Returning cached CommP:', this._commp.toString());
        }
        return this._commp;
    }
    async store() {
        console.log('[MockSynapse] UploadTask.store() called');
        if (this._sp == null) {
            console.log('[MockSynapse] Ensuring CommP is generated before storage...');
            await this.commp();
            console.log('[MockSynapse] Negotiating with storage provider...');
            this._sp = 'f01234';
            console.log('[MockSynapse] Selected storage provider:', this._sp);
            console.log('[MockSynapse] Simulating storage negotiation delay (500ms)...');
            await new Promise(resolve => setTimeout(resolve, 500));
            console.log('[MockSynapse] Storage negotiation complete');
        }
        else {
            console.log('[MockSynapse] Returning cached storage provider:', this._sp);
        }
        return this._sp;
    }
    async done() {
        console.log('[MockSynapse] UploadTask.done() called');
        if (this._txHash == null) {
            console.log('[MockSynapse] Ensuring storage is complete before chain commit...');
            await this.store();
            console.log('[MockSynapse] Submitting transaction to blockchain...');
            this._txHash = '0x' + Array.from({ length: 64 }, () => Math.floor(Math.random() * 16).toString(16)).join('');
            console.log('[MockSynapse] Generated mock transaction hash:', this._txHash);
            console.log('[MockSynapse] Simulating blockchain confirmation delay (1000ms)...');
            await new Promise(resolve => setTimeout(resolve, 1000));
            console.log('[MockSynapse] Transaction confirmed on chain');
        }
        else {
            console.log('[MockSynapse] Returning cached transaction hash:', this._txHash);
        }
        return this._txHash;
    }
}
//# sourceMappingURL=upload-task.js.map