# MCP NFT Migration - 快速开始指南

## 🚀 立即开始（3 步）

### 1️⃣ 验证配置

```bash
cd /var/tmp/vibe-kanban/worktrees/0d79-aiagent/mcp-nft-migration
./scripts/verify-env.sh
```

**预期输出**：
```
✅ 所有必需的环境变量已配置！
```

### 2️⃣ 重启 Claude Code

为了让环境变量配置生效，需要重启 Claude Code 应用。

### 3️⃣ 验证连接

在 Claude Code 中运行：
```
/mcp
```

应该看到 `nft-migration` 服务状态为 ✅ 已连接。

---

## 📋 可用的 MCP 工具

在 Claude Code 中，你可以使用以下工具：

### 🔧 设置和验证

| 工具 | 用途 |
|-----|------|
| `verify_setup` | 验证环境配置是否正确 |
| `setup_approvals` | 设置 Filecoin 存储所需的授权 |
| `check_balances` | 检查钱包余额（FIL、USDFC） |

### 📤 上传到 Filecoin

| 工具 | 用途 |
|-----|------|
| `upload_to_filecoin` | 上传 NFT 元数据到 Filecoin |
| `test_upload` | 使用测试数据测试上传功能 |

### 🖼️ NFT 扫描

| 工具 | 用途 |
|-----|------|
| `nft_scan` | 扫描 NFT 合约，获取 NFT 列表 |
| `get_nft_metadata` | 获取单个 NFT 的元数据 |

### ✅ ERC-8004 验证

| 工具 | 用途 |
|-----|------|
| `erc8004_validate` | 使用 ERC-8004 验证 NFT 迁移 |
| `update_contract_uri` | 更新 NFT 合约的 tokenURI |

---

## 🗂️ 可用的资源

在 Claude Code 中，你可以查询以下资源：

```
请读取 nft-migration://status            # 当前迁移任务状态
请读取 nft-migration://balances          # 钱包余额
请读取 nft-migration://contracts         # Filecoin 合约地址
请读取 nft-migration://environment       # 环境配置信息
```

---

## 💡 示例用法

### 示例 1: 验证环境配置

在 Claude Code 中：
```
请使用 verify_setup 工具验证环境配置
```

### 示例 2: 扫描 Azuki NFT

```
请使用 nft_scan 工具扫描 Azuki NFT 合约（Token ID 0-4）

合约地址：0xED5AF388653567Af2F388E6224dC7C4b3241C544
Token ID 范围：0-4
```

### 示例 3: 测试 Filecoin 上传

```
请使用 test_upload 工具测试 Filecoin 上传功能
```

### 示例 4: 查看环境配置

```
请读取 nft-migration://environment 资源，显示所有环境配置
```

---

## 🌐 网络配置

当前配置使用 3 个网络：

| 网络 | 用途 | Chain ID | RPC URL |
|-----|------|----------|---------|
| 🔵 **Ethereum Mainnet** | 读取 NFT 数据（只读） | 1 | eth-mainnet.public.blastapi.io |
| 🟣 **Ethereum Sepolia** | ERC-8004 验证（测试网） | 11155111 | eth-sepolia.public.blastapi.io |
| 🟢 **Filecoin Calibration** | IPFS → Filecoin 存储（测试网） | 314159 | api.calibration.node.glif.io |

**注意**：
- ✅ 主网只读，无需 gas 费用！
- ✅ 测试网交易使用测试币（免费）
- ✅ 私钥仅用于测试网，安全无风险

---

## 📊 NFT 配置

| 配置项 | 值 |
|-------|-----|
| **NFT 合约** | Azuki (0xED5AF388653567Af2F388E6224dC7C4b3241C544) |
| **Token ID 范围** | 0 - 4 (共 5 个 NFT) |
| **总供应量** | 10,000 个 NFT |
| **元数据存储** | IPFS |
| **IPFS 网关** | https://ipfs.io/ipfs/ |

---

## 🔑 ERC-8004 合约（Sepolia 测试网）

| 合约 | 地址 |
|-----|------|
| **Agent Identity** | 0x7177a6867296406881E20d6647232314736Dd09A |
| **Agent Reputation** | 0xB5048e3ef1DA4E04deB6f7d0423D06F63869e322 |
| **Agent Validation** | 0x662b40A526cb4017d947e71eAF6753BF3eeE66d8 |

这些是 ERC-8004 标准的官方参考实现合约。

---

## 🛠️ 故障排除

### ❌ MCP Server 未连接

**解决方案**：
1. 运行 `./scripts/verify-env.sh` 验证配置
2. 检查构建文件：`ls -l build/index.js`
3. 重启 Claude Code
4. 再次运行 `/mcp` 验证

### ❌ 环境变量未生效

**解决方案**：
1. 确认已重启 Claude Code
2. 检查配置文件：`cat ~/.claude.json | jq '.mcpServers."nft-migration"'`
3. 验证 JSON 格式正确

### ❌ 工具执行出错

**解决方案**：
1. 检查网络连接（需要访问以太坊和 Filecoin RPC）
2. 验证代理配置（如果使用代理）
3. 查看日志：`tail -f logs/daemon-*.log`

---

## 📚 完整文档

| 文档 | 说明 |
|-----|------|
| [完成总结.md](./完成总结.md) | 完整的配置和更新总结 |
| [环境变量同步完成.md](./环境变量同步完成.md) | 环境变量详细说明 |
| [代码环境变量适配完成.md](./代码环境变量适配完成.md) | 代码更新详情 |
| [stdio模式环境变量配置.md](./stdio模式环境变量配置.md) | stdio 模式指南 |
| [HTTP_模式使用指南.md](./HTTP_模式使用指南.md) | HTTP 守护进程模式指南 |
| [DAEMON_MODE_DESIGN.md](./DAEMON_MODE_DESIGN.md) | 守护进程架构设计 |
| [DAEMON_DEPLOYMENT.md](./DAEMON_DEPLOYMENT.md) | 部署和运维指南 |

---

## 🎯 常见任务

### 任务 1: 扫描和上传 NFT 到 Filecoin

1. 扫描 NFT：`请使用 nft_scan 扫描合约`
2. 查看元数据：`请使用 get_nft_metadata 获取 Token ID 0 的元数据`
3. 上传到 Filecoin：`请使用 upload_to_filecoin 上传 Token ID 0`
4. ERC-8004 验证：`请使用 erc8004_validate 验证上传结果`

### 任务 2: 检查钱包和余额

```
请使用 check_balances 工具检查钱包余额
```

### 任务 3: 设置 Filecoin 授权

```
请使用 setup_approvals 工具设置 Filecoin 存储授权
```

---

## ⚡ 进阶：HTTP 守护进程模式

如果需要独立运行 MCP Server（不依赖 Claude Code）：

```bash
# 启动守护进程
PORT=3000 node build/index-daemon.js

# 或使用脚本
PORT=3000 ./scripts/daemon-manager.sh start

# 检查状态
curl http://localhost:3000/health
```

详见 [HTTP_模式使用指南.md](./HTTP_模式使用指南.md)

---

## ✅ 验证清单

- [x] 环境变量已配置（20 个）
- [x] 源代码已更新
- [x] TypeScript 已编译
- [x] 验证脚本通过
- [ ] Claude Code 已重启
- [ ] MCP 连接已验证
- [ ] 工具可正常使用

---

**🎉 现在可以开始使用 MCP NFT Migration 工具了！**

有任何问题，请参考完整文档或运行验证脚本排查。
