# ERC-8004 éªŒè¯æµ‹è¯•æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### ğŸ¯ ç›®æ ‡

éªŒè¯ NFT IPFS to Filecoin è¿ç§»è¿‡ç¨‹ï¼Œä½¿ç”¨ ERC-8004 æ ‡å‡†åœ¨åŒºå—é“¾ä¸Šè®°å½•ï¼š
1. AI Agent èº«ä»½
2. è¿ç§»ä»»åŠ¡è¯¦æƒ…
3. è¿ç§»ç»“æœè¯æ˜
4. éªŒè¯è€…ç¡®è®¤

### âš¡ å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
cd /var/tmp/vibe-kanban/worktrees/0d79-aiagent/mvp-demo
chmod +x test-erc8004-simple.js
node test-erc8004-simple.js
```

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ§ª ERC-8004 éªŒè¯æµç¨‹æµ‹è¯•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¡ è¿æ¥ Sepolia æµ‹è¯•ç½‘...
   åœ°å€: 0xB34d4c8E3AcCB5FA62455228281649Be525D4e59
   ä½™é¢: 1.5 ETH

ğŸ”§ åˆå§‹åŒ– ERC-8004 å®¢æˆ·ç«¯...
   Identity åˆçº¦: 0x7177a6867296406881E20d6647232314736Dd09A
   Validation åˆçº¦: 0x662b40A526cb4017d947e71eAF6753BF3eeE66d8

ğŸ“ æ³¨å†Œ Agent...
âœ… Agent æ³¨å†ŒæˆåŠŸï¼
   Agent ID: 1
   äº¤æ˜“å“ˆå¸Œ: 0x123abc...

ğŸ“ åˆ›å»ºéªŒè¯è¯·æ±‚...
âœ… éªŒè¯è¯·æ±‚å·²åˆ›å»ºï¼
   Request Hash: 0x456def...

ğŸ“¤ æäº¤éªŒè¯ç»“æœ...
âœ… éªŒè¯ç»“æœå·²æäº¤ï¼

ğŸ‰ ERC-8004 éªŒè¯æµç¨‹å®Œæˆï¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š æœ€ç»ˆéªŒè¯ç»“æœ:
   çŠ¶æ€: Completed
   éªŒè¯é€šè¿‡: âœ… æ˜¯
   è¯æ˜ URI: ipfs://QmProofMetadataExample12345
```

## ğŸ”§ å½“å‰ MCP å·¥å…·çŠ¶æ€

### âš ï¸ éœ€è¦ä¿®å¤

MCP ä¸­çš„ ERC-8004 å·¥å…·å¼•ç”¨äº†ä¸å­˜åœ¨çš„ `phases/` ç›®å½•ï¼Œéœ€è¦ä¿®å¤ï¼š

**ç°æœ‰å·¥å…·**ï¼ˆéœ€è¦ä¿®å¤ï¼‰ï¼š
- âŒ `erc8004_validate` - å¼•ç”¨ `Phase5_ERC8004Validation`
- âŒ `update_contract_uri` - å¼•ç”¨ `Phase4_UpdateContract`

**æ¨èæ–¹æ¡ˆ**ï¼š
1. **çŸ­æœŸ**ï¼šç›´æ¥ä½¿ç”¨ `erc8004-client.js`ï¼ˆâœ… å¯ç”¨ï¼‰
2. **é•¿æœŸ**ï¼šä¿®å¤ MCP å·¥å…·ï¼Œä½¿å…¶ä½¿ç”¨ `ERC8004Client` ç±»

## ğŸ“‹ å®Œæ•´éªŒè¯æµç¨‹

### æ­¥éª¤ 1: å‡†å¤‡ç¯å¢ƒ

ç¡®ä¿ `.env` æ–‡ä»¶åŒ…å«å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼š

```bash
# Sepolia æµ‹è¯•ç½‘
VALIDATION_NETWORK_RPC_URL=https://eth-sepolia.public.blastapi.io
VALIDATION_NETWORK_CHAIN_ID=11155111
VALIDATOR_PRIVATE_KEY=0xade117fff...

# ERC-8004 åˆçº¦åœ°å€
AGENT_IDENTITY_ADDRESS=0x7177a6867296406881E20d6647232314736Dd09A
AGENT_REPUTATION_ADDRESS=0xB5048e3ef1DA4E04deB6f7d0423D06F63869e322
AGENT_VALIDATION_ADDRESS=0x662b40A526cb4017d947e71eAF6753BF3eeE66d8
```

### æ­¥éª¤ 2: æ³¨å†Œ AI Agent

```javascript
import { ERC8004Client } from './erc8004-client.js';

const client = new ERC8004Client(provider, signer, identityAddress, validationAddress);

// ç”Ÿæˆ Agent å…ƒæ•°æ®
const metadata = client.generateAgentMetadata(
  'NFT Migration Agent',
  'AI Agent for migrating NFT metadata',
  ['https://api.example.com'],
  ['nft-scan', 'filecoin-upload']
);

// æ³¨å†Œ
const registration = await client.registerAgent('ipfs://QmAgentMetadata...');
console.log('Agent ID:', registration.agentId);
```

**é“¾ä¸ŠéªŒè¯**ï¼š
- è®¿é—® https://sepolia.etherscan.io/token/0x7177a6867296406881E20d6647232314736Dd09A
- æŸ¥æ‰¾ä½ çš„ Agent ID (Token ID)

### æ­¥éª¤ 3: æ‰§è¡Œ NFT è¿ç§»

ä½¿ç”¨ MCP å·¥å…·æ‰«æå’Œä¸Šä¼ ï¼š

```
# åœ¨ Claude Code ä¸­

è¯·ä½¿ç”¨ nft_scan å·¥å…·æ‰«æ Azuki NFT #0-#4
åˆçº¦åœ°å€: 0xED5AF388653567Af2F388E6224dC7C4b3241C544

è¯·ä½¿ç”¨ upload_to_filecoin å·¥å…·ä¸Šä¼ æ¯ä¸ª Token çš„å…ƒæ•°æ®
```

è®°å½•è¿ç§»ç»“æœï¼š
- Token ID
- IPFS CID
- Filecoin PieceCID
- æ˜¯å¦æˆåŠŸ

### æ­¥éª¤ 4: åˆ›å»ºéªŒè¯è¯·æ±‚

```javascript
// ç”Ÿæˆä»»åŠ¡å…ƒæ•°æ®
const taskMetadata = client.generateTaskMetadata(
  'Migrate Azuki NFT #0-#4',
  '0xED5AF388653567Af2F388E6224dC7C4b3241C544',
  { start: 0, end: 4 },
  ['QmZcH4YvBVVRJtdn4RdbaqgspFU8gH6P9vomDpBVpAL3u4']
);

// ä¸Šä¼ ä»»åŠ¡å…ƒæ•°æ®åˆ° IPFSï¼Œè·å¾— taskURI
const taskURI = 'ipfs://QmTask...';

// åˆ›å»ºéªŒè¯è¯·æ±‚
const request = await client.createValidationRequest(
  agentId,
  taskURI,
  validatorAddress
);
console.log('Request Hash:', request.requestHash);
```

**é“¾ä¸ŠéªŒè¯**ï¼š
- è®¿é—® https://sepolia.etherscan.io/tx/[request.txHash]
- æŸ¥çœ‹ `ValidationRequested` äº‹ä»¶

### æ­¥éª¤ 5: æäº¤éªŒè¯ç»“æœ

```javascript
// ç”Ÿæˆè¯æ˜å…ƒæ•°æ®
const migrationResults = [
  {
    ipfsCid: 'QmZcH4YvBVVRJtdn4RdbaqgspFU8gH6P9vomDpBVpAL3u4/0',
    filecoinPieceCid: 'bafkzcib...',
    filecoinCarCid: 'baga...',
    success: true
  },
  // ... æ›´å¤šç»“æœ
];

const proofMetadata = client.generateProofMetadata(taskURI, migrationResults);

// ä¸Šä¼ è¯æ˜åˆ° IPFSï¼Œè·å¾— proofURI
const proofURI = 'ipfs://QmProof...';

// æäº¤éªŒè¯
const validation = await client.submitValidation(
  request.requestHash,
  true, // è¿ç§»æˆåŠŸ
  proofURI
);
console.log('Validation Tx:', validation.txHash);
```

**é“¾ä¸ŠéªŒè¯**ï¼š
- è®¿é—® https://sepolia.etherscan.io/tx/[validation.txHash]
- æŸ¥çœ‹ `ValidationSubmitted` äº‹ä»¶

### æ­¥éª¤ 6: æŸ¥è¯¢éªŒè¯çŠ¶æ€

```javascript
const status = await client.getValidationRequest(request.requestHash);

console.log('çŠ¶æ€:', status.status); // Completed
console.log('éªŒè¯é€šè¿‡:', status.isValid); // true
console.log('è¯æ˜ URI:', status.proofURI);
```

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: å®Œæ•´ç«¯åˆ°ç«¯æµ‹è¯•

ä½¿ç”¨æä¾›çš„ `test-erc8004-simple.js`ï¼š

```bash
node test-erc8004-simple.js
```

**éªŒè¯ç‚¹**ï¼š
- âœ… Agent æˆåŠŸæ³¨å†Œ
- âœ… éªŒè¯è¯·æ±‚å·²åˆ›å»º
- âœ… éªŒè¯ç»“æœå·²æäº¤
- âœ… çŠ¶æ€ä¸º "Completed"
- âœ… isValid ä¸º true

### åœºæ™¯ 2: ä»…æ³¨å†Œ Agent

```javascript
const registration = await client.registerAgent('ipfs://QmAgent...');
const agentInfo = await client.getAgent(registration.agentId);
```

**éªŒè¯ç‚¹**ï¼š
- âœ… agentInfo.owner ç­‰äºä½ çš„åœ°å€
- âœ… agentInfo.metadataURI æ­£ç¡®
- âœ… agentInfo.isActive ä¸º true

### åœºæ™¯ 3: æŸ¥è¯¢ç°æœ‰éªŒè¯

```javascript
// ä½¿ç”¨ä¹‹å‰çš„ request hash
const status = await client.getValidationRequest('0x123abc...');
```

**éªŒè¯ç‚¹**ï¼š
- âœ… èƒ½å¤ŸæŸ¥è¯¢åˆ°éªŒè¯è¯·æ±‚
- âœ… çŠ¶æ€å’Œç»“æœæ­£ç¡®

## ğŸ“Š å…ƒæ•°æ®ç¤ºä¾‹

### Agent å…ƒæ•°æ®

```json
{
  "name": "NFT Migration Agent v1.0",
  "description": "AI Agent for migrating NFT metadata from IPFS to Filecoin",
  "endpoints": ["https://api.nft-migration.example.com"],
  "capabilities": ["nft-scan", "filecoin-upload", "metadata-migration"],
  "supportedTrust": ["validation"],
  "version": "1.0.0",
  "timestamp": "2025-10-20T01:30:00.000Z"
}
```

### Task å…ƒæ•°æ®

```json
{
  "task": "NFT IPFS to Filecoin Migration",
  "description": "Migrate Azuki NFT #0-#4 from IPFS to Filecoin",
  "nftContract": "0xED5AF388653567Af2F388E6224dC7C4b3241C544",
  "tokenRange": { "start": 0, "end": 4 },
  "ipfsCids": ["QmZcH4YvBVVRJtdn4RdbaqgspFU8gH6P9vomDpBVpAL3u4"],
  "timestamp": "2025-10-20T01:30:00.000Z"
}
```

### Proof å…ƒæ•°æ®

```json
{
  "taskURI": "ipfs://QmTask...",
  "proof": {
    "type": "FilecoinMigration",
    "migrationResults": [
      {
        "ipfsCid": "QmZcH4YvBVVRJtdn4RdbaqgspFU8gH6P9vomDpBVpAL3u4/0",
        "filecoinPieceCid": "bafkzcib...",
        "success": true
      }
    ],
    "summary": {
      "total": 5,
      "successful": 5,
      "failed": 0,
      "successRate": 100
    }
  },
  "verificationMethod": "On-chain storage proof via Synapse SDK",
  "timestamp": "2025-10-20T01:30:00.000Z"
}
```

## ğŸ” éªŒè¯æ£€æŸ¥æ¸…å•

### æ³¨å†ŒéªŒè¯

- [ ] Agent ID å·²ç”Ÿæˆ
- [ ] äº¤æ˜“å·²ç¡®è®¤
- [ ] `ownerOf(agentId)` è¿”å›æ­£ç¡®çš„åœ°å€
- [ ] `tokenURI(agentId)` è¿”å›æ­£ç¡®çš„å…ƒæ•°æ® URI
- [ ] Etherscan ä¸Šå¯æŸ¥çœ‹äº¤æ˜“

### éªŒè¯è¯·æ±‚éªŒè¯

- [ ] Request Hash å·²ç”Ÿæˆ
- [ ] äº¤æ˜“å·²ç¡®è®¤
- [ ] `ValidationRequested` äº‹ä»¶å·²è§¦å‘
- [ ] `getValidationRequest()` è¿”å›æ­£ç¡®ä¿¡æ¯
- [ ] Etherscan ä¸Šå¯æŸ¥çœ‹äº¤æ˜“

### éªŒè¯æäº¤éªŒè¯

- [ ] äº¤æ˜“å·²ç¡®è®¤
- [ ] `ValidationSubmitted` äº‹ä»¶å·²è§¦å‘
- [ ] çŠ¶æ€æ›´æ–°ä¸º "Completed"
- [ ] `isValid` ä¸º true
- [ ] `proofURI` æ­£ç¡®
- [ ] Etherscan ä¸Šå¯æŸ¥çœ‹äº¤æ˜“

## ğŸš¨ å¸¸è§é—®é¢˜

### é—®é¢˜ 1: ä½™é¢ä¸è¶³

```
Error: insufficient funds for intrinsic transaction cost
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- è®¿é—® Sepolia Faucet è·å–æµ‹è¯• ETH
- https://sepoliafaucet.com/
- æˆ– https://faucet.quicknode.com/ethereum/sepolia

### é—®é¢˜ 2: æ³¨å†Œè´¹ç”¨

```
Registration Fee: 0.001 ETH
```

**è¯´æ˜**ï¼š
- å½“å‰åˆçº¦è®¾ç½®æ³¨å†Œè´¹ç”¨ä¸º 0 ETH
- å¦‚æœæ˜¾ç¤ºéé›¶ï¼Œè¯´æ˜åˆçº¦é…ç½®ä¸åŒ
- ç¡®ä¿é’±åŒ…æœ‰è¶³å¤Ÿä½™é¢

### é—®é¢˜ 3: äº¤æ˜“å¤±è´¥

```
Error: transaction reverted
```

**æ£€æŸ¥**ï¼š
- Gas limit æ˜¯å¦è¶³å¤Ÿ
- åˆçº¦åœ°å€æ˜¯å¦æ­£ç¡®
- ç§é’¥æ˜¯å¦æ­£ç¡®
- ç½‘ç»œæ˜¯å¦æ­£ç¡®ï¼ˆSepoliaï¼‰

### é—®é¢˜ 4: éªŒè¯è¯·æ±‚æŸ¥è¯¢å¤±è´¥

```
Error: call reverted exception
```

**å¯èƒ½åŸå› **ï¼š
- Request Hash ä¸å­˜åœ¨
- åˆçº¦åœ°å€é”™è¯¯
- ç½‘ç»œé”™è¯¯

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **ERC-8004 å®Œæ•´æŒ‡å—**: [ERC8004éªŒè¯å®Œæ•´æŒ‡å—.md](./ERC8004éªŒè¯å®Œæ•´æŒ‡å—.md)
- **ç¯å¢ƒå˜é‡é…ç½®**: [å®Œæˆæ€»ç»“.md](./å®Œæˆæ€»ç»“.md)
- **MCP å·¥å…·ä½¿ç”¨**: [å¿«é€Ÿå¼€å§‹.md](./å¿«é€Ÿå¼€å§‹.md)

## ğŸ¯ æ€»ç»“

### å¦‚ä½•éªŒè¯ ERC-8004 æ•ˆæœ

1. **è¿è¡Œæµ‹è¯•è„šæœ¬**ï¼š
   ```bash
   node test-erc8004-simple.js
   ```

2. **åœ¨ Etherscan ä¸ŠéªŒè¯**ï¼š
   - Agent æ³¨å†Œäº¤æ˜“
   - éªŒè¯è¯·æ±‚äº¤æ˜“
   - éªŒè¯æäº¤äº¤æ˜“

3. **æŸ¥è¯¢é“¾ä¸ŠçŠ¶æ€**ï¼š
   ```javascript
   const agent = await client.getAgent(agentId);
   const request = await client.getValidationRequest(requestHash);
   ```

4. **éªŒè¯æˆåŠŸæ ‡å‡†**ï¼š
   - âœ… æ‰€æœ‰äº¤æ˜“å·²ç¡®è®¤
   - âœ… Agent å·²æ³¨å†Œ
   - âœ… éªŒè¯çŠ¶æ€ä¸º "Completed"
   - âœ… isValid ä¸º true
   - âœ… è¯æ˜ URI å¯è®¿é—®

### ä¸‹ä¸€æ­¥

- [ ] ä¿®å¤ MCP å·¥å…·ï¼Œé›†æˆ ERC8004Client
- [ ] æ·»åŠ  IPFS ä¸Šä¼ åŠŸèƒ½ï¼ˆå…ƒæ•°æ®ã€ä»»åŠ¡ã€è¯æ˜ï¼‰
- [ ] åˆ›å»ºå®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•æµç¨‹
- [ ] éƒ¨ç½²åˆ°ä¸»ç½‘ï¼ˆå¯é€‰ï¼‰

**çŠ¶æ€**: âœ… ERC-8004 å®¢æˆ·ç«¯å¯ç”¨ï¼Œæµ‹è¯•è„šæœ¬å°±ç»ªï¼
